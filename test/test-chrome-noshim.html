<!doctype html>
<script type="importmap">
{
  "imports": {
    "app": "data:text/javascript,window.native=true;window.shared=0;",
    "shared": "data:text/javascript,window.shared++;"
  }
}
</script>
<script async src="https://unpkg.com/construct-style-sheets-polyfill@3.0.0/dist/adoptedStyleSheets.js"></script>
<script type="module">
import 'app';
import 'shared';
import x from '/test/fixtures/css-assertion.js';

if (!window.native)
  throw new Error('Expected native exec');
if (window.shared !== 1)
  throw new Error('Expected shared execution once');
if (window.polyfill)
  throw new Error('Did not expect polyfill execution');

window.counter = 1;
</script>

<script type="module" skip-shim="import-maps">
window.counter += 1;
if (window.counter !== 2)
  throw new Error('Expected previous exec');

fetch('/done');
</script>
<script type="module" src="/src/es-module-shims.js" async></script>
